{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Email - Extract Indicators",
    "aliasName": null,
    "tag": "#PostCreate",
    "description": "Extract Indicators from Body, Header",
    "isActive": false,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "lastModifyDate": 1646219489,
    "collection": "\/api\/3\/workflow_collections\/817daef5-8d0e-4c2e-8cd7-7d5d8da9ceb4",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/f3c36ac9-72c1-4cb2-ba57-867dde67a0f5",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Extract Indicators from header",
            "description": null,
            "arguments": {
                "name": "CyOps Utilities",
                "params": {
                    "data": "{{vars.email_header | toJSON}}"
                },
                "message": {
                    "content": "<p>Extracting Indicators from the email header<\/p>",
                    "records": "['{{vars.alertRecordIRI}}']"
                },
                "version": "2.0.0",
                "connector": "cyops_utilities",
                "operation": "extract_artifacts",
                "operationTitle": "CyOPs: Extract Artifacts from string",
                "step_variables": {
                    "all_indicators": "{{ vars.result.data }}"
                },
                "operationOutput": []
            },
            "status": null,
            "top": "435",
            "left": "825",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "uuid": "c33607ff-302d-4713-bf3b-e5b7b1300160"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "email": "{{vars.input.records[0]}}",
                "email_header": "{{vars.input.records[0].emailHeader  | from_json}}",
                "eMailRecordIRI": "{{vars.input.records[0]['@id']}}"
            },
            "status": null,
            "top": "165",
            "left": "825",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "uuid": "14870ed5-cf77-400e-bcbb-ffdc015bcf81"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Email Indicators",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.email_indicators}}",
                    "condition": ""
                },
                "arguments": {
                    "indicatorType": "{{(\"IndicatorType\" | picklist(\"Email Address\"))[\"@id\"]}}",
                    "alertRecordIRI": "{{vars. alertRecordIRI}}",
                    "emailRecordIRI": "{{vars.eMailRecordIRI}}",
                    "indicatorValue": "{{vars.item}}",
                    "incidentRecordIRI": ""
                },
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/f964e65f-bbeb-452f-81b8-674bbbd42223"
            },
            "status": null,
            "top": "840",
            "left": "825",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "80d8a1f2-ae9c-495d-8248-3959283342c8"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Related Alert",
            "description": null,
            "arguments": {
                "name": "CyOps Utilities",
                "params": {
                    "iri": "{{vars.input.records[0]['@id']}}\/alerts",
                    "body": "",
                    "method": "GET"
                },
                "version": "2.7.0",
                "connector": "cyops_utilities",
                "operation": "make_cyops_request",
                "operationTitle": "CyOPs: Make CyOPs API Call",
                "step_variables": {
                    "alertRecordIRI": "{{ vars.result.data[\"hydra:member\"][0][\"@id\"] }}"
                }
            },
            "status": null,
            "top": "300",
            "left": "825",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "uuid": "30f2c64e-442b-484d-a892-b2aae31d2a0c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract Indicators from body",
            "description": null,
            "arguments": {
                "name": "CyOps Utilities",
                "params": {
                    "data": "{{vars.email.emailBody}}"
                },
                "message": {
                    "content": "<p>Extracting Indicators from the email body<\/p>",
                    "records": "['{{vars.alertRecordIRI}}']"
                },
                "version": "2.0.0",
                "connector": "cyops_utilities",
                "operation": "extract_artifacts",
                "operationTitle": "CyOPs: Extract Artifacts from string",
                "step_variables": {
                    "ip_indicators": "{{ vars.steps.Extract_Indicators_from_header.data.IP | union(vars.result.data.IP) }}",
                    "url_indicators": "{{ vars.steps.Extract_Indicators_from_header.data.URL | union(vars.result.data.URL) }}",
                    "email_indicators": "{{ vars.steps.Extract_Indicators_from_header.data.Email | union(vars.result.data.Email) }}",
                    "domain_indicators": "{{ vars.steps.Extract_Indicators_from_header.data.Host | union(vars.result.data.Host) }}"
                },
                "operationOutput": []
            },
            "status": null,
            "top": "570",
            "left": "825",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "uuid": "eb49757e-cae4-41b1-bc40-9b66b7f4a4f1"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Domain Indicators",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.domain_indicators}}",
                    "condition": ""
                },
                "arguments": {
                    "indicatorType": "{{(\"IndicatorType\" | picklist(\"Domain\"))[\"@id\"]}}",
                    "alertRecordIRI": "{{vars. alertRecordIRI}}",
                    "emailRecordIRI": "{{vars.eMailRecordIRI}}",
                    "indicatorValue": "{{vars.item}}",
                    "incidentRecordIRI": ""
                },
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/f964e65f-bbeb-452f-81b8-674bbbd42223"
            },
            "status": null,
            "top": "840",
            "left": "1175",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "3c2a9afb-e398-4dad-930a-74aaf6671497"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create URL Indicators",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.url_indicators}}",
                    "condition": ""
                },
                "arguments": {
                    "indicatorType": "{{(\"IndicatorType\" | picklist(\"URL\"))[\"@id\"]}}",
                    "alertRecordIRI": "{{vars. alertRecordIRI}}",
                    "emailRecordIRI": "{{vars.eMailRecordIRI}}",
                    "indicatorValue": "{{vars.item}}",
                    "incidentRecordIRI": ""
                },
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/f964e65f-bbeb-452f-81b8-674bbbd42223"
            },
            "status": null,
            "top": "840",
            "left": "1525",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "28d16364-2d8b-4876-a5f1-d51622575658"
        },
        {
            "@type": "WorkflowStep",
            "name": "Set",
            "description": null,
            "arguments": {
                "flattenedListUpdated": "{% for item in vars.indicators | dictsort %} {{ vars.flatenedlist.append( item[-1:] | join(\", \")) }} {% endfor%}"
            },
            "status": null,
            "top": "840",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "uuid": "cf8e0c8f-f5a7-457b-ba11-de9ec2373bb2"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "resource": "emails",
                "step_variables": [],
                "fieldbasedtrigger": {
                    "limit": 30,
                    "logic": "AND",
                    "filters": []
                }
            },
            "status": null,
            "top": "30",
            "left": "825",
            "stepType": "\/api\/3\/workflow_step_types\/ea155646-3821-4542-9702-b246da430a8d",
            "uuid": "f3c36ac9-72c1-4cb2-ba57-867dde67a0f5"
        },
        {
            "@type": "WorkflowStep",
            "name": "All Indicators",
            "description": null,
            "arguments": {
                "indicators": "{'\/api\/3\/picklists\/c0beeda4-2c7a-4214-b7e5-53ba1649539c': {{vars.ip_indicators}}, '\/api\/3\/picklists\/353a37b4-3eeb-43ee-aac6-64806422cfec': {{vars.url_indicators}}, '\/api\/3\/picklists\/5a5a7d42-be27-4903-858a-19909ebfa1eb': {{vars.domain_indicators}}, '\/api\/3\/picklists\/80bd55b0-6d88-4beb-bec3-97954f261c4d': {{vars.email_indicators}}}",
                "flatenedlist": "[]"
            },
            "status": null,
            "top": "705",
            "left": "825",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "uuid": "ca9d87bd-2b2c-428e-8fad-ca3134f0eefa"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create IP Indicators",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.ip_indicators}}",
                    "condition": ""
                },
                "arguments": {
                    "indicatorType": "{{(\"IndicatorType\" | picklist(\"IP Address\"))[\"@id\"]}}",
                    "alertRecordIRI": "{{vars. alertRecordIRI}}",
                    "emailRecordIRI": "{{vars.eMailRecordIRI}}",
                    "indicatorValue": "{{vars.item}}",
                    "incidentRecordIRI": ""
                },
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/f964e65f-bbeb-452f-81b8-674bbbd42223"
            },
            "status": null,
            "top": "840",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "0ec249ac-5f29-47ec-96f1-ecf40c41403d"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/14870ed5-cf77-400e-bcbb-ffdc015bcf81",
            "sourceStep": "\/api\/3\/workflow_steps\/f3c36ac9-72c1-4cb2-ba57-867dde67a0f5",
            "label": null,
            "isExecuted": false,
            "uuid": "fa94e072-fcbc-45e4-84c6-48b1b3465156"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Extract Indicators from Header -> Extract Indicators from body",
            "targetStep": "\/api\/3\/workflow_steps\/eb49757e-cae4-41b1-bc40-9b66b7f4a4f1",
            "sourceStep": "\/api\/3\/workflow_steps\/c33607ff-302d-4713-bf3b-e5b7b1300160",
            "label": null,
            "isExecuted": false,
            "uuid": "8ce4a573-cfd7-491c-bccd-5dcbcd4722a9"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get Related Incident",
            "targetStep": "\/api\/3\/workflow_steps\/30f2c64e-442b-484d-a892-b2aae31d2a0c",
            "sourceStep": "\/api\/3\/workflow_steps\/14870ed5-cf77-400e-bcbb-ffdc015bcf81",
            "label": null,
            "isExecuted": false,
            "uuid": "5d65b1e0-6966-43eb-8d8f-b0fddd290006"
        },
        {
            "@type": "WorkflowRoute",
            "name": "All Indicators -> Create IP Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/0ec249ac-5f29-47ec-96f1-ecf40c41403d",
            "sourceStep": "\/api\/3\/workflow_steps\/ca9d87bd-2b2c-428e-8fad-ca3134f0eefa",
            "label": null,
            "isExecuted": false,
            "uuid": "92e175fe-1ba9-4f27-94a9-2ced40e51f7e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "All Indicators -> Set",
            "targetStep": "\/api\/3\/workflow_steps\/cf8e0c8f-f5a7-457b-ba11-de9ec2373bb2",
            "sourceStep": "\/api\/3\/workflow_steps\/ca9d87bd-2b2c-428e-8fad-ca3134f0eefa",
            "label": null,
            "isExecuted": false,
            "uuid": "faeac079-9337-4bdb-be4f-4018c05f0971"
        },
        {
            "@type": "WorkflowRoute",
            "name": "All Indicators -> Copy  of Create Domain Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/80d8a1f2-ae9c-495d-8248-3959283342c8",
            "sourceStep": "\/api\/3\/workflow_steps\/ca9d87bd-2b2c-428e-8fad-ca3134f0eefa",
            "label": null,
            "isExecuted": false,
            "uuid": "b6f4e185-c37c-475e-b5c4-0ceca5ba68bb"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Related Incident -> Extract Indicators from Header",
            "targetStep": "\/api\/3\/workflow_steps\/c33607ff-302d-4713-bf3b-e5b7b1300160",
            "sourceStep": "\/api\/3\/workflow_steps\/30f2c64e-442b-484d-a892-b2aae31d2a0c",
            "label": null,
            "isExecuted": false,
            "uuid": "d81c1646-a546-47b3-8b68-fca0ea41b1b9"
        },
        {
            "@type": "WorkflowRoute",
            "name": "All Indicators -> Copy  of Create IP Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/3c2a9afb-e398-4dad-930a-74aaf6671497",
            "sourceStep": "\/api\/3\/workflow_steps\/ca9d87bd-2b2c-428e-8fad-ca3134f0eefa",
            "label": null,
            "isExecuted": false,
            "uuid": "7380a2eb-b9dd-4019-b62b-121ac8df6aec"
        },
        {
            "@type": "WorkflowRoute",
            "name": "All Indicators -> Create Indicator Records",
            "targetStep": "\/api\/3\/workflow_steps\/28d16364-2d8b-4876-a5f1-d51622575658",
            "sourceStep": "\/api\/3\/workflow_steps\/ca9d87bd-2b2c-428e-8fad-ca3134f0eefa",
            "label": null,
            "isExecuted": false,
            "uuid": "6ea3cef2-39c5-455c-933d-9e3161562105"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Extract Indicators from body -> All Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/ca9d87bd-2b2c-428e-8fad-ca3134f0eefa",
            "sourceStep": "\/api\/3\/workflow_steps\/eb49757e-cae4-41b1-bc40-9b66b7f4a4f1",
            "label": null,
            "isExecuted": false,
            "uuid": "8638995f-6814-46e3-b894-f94555a45dae"
        }
    ],
    "priority": null,
    "uuid": "76d861e2-d1af-47ff-beec-1f026d1b814b",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "PostCreate",
        "Email"
    ]
}