{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Phishing - Suspicious Email Alert - Extract Indicators",
    "aliasName": null,
    "tag": "#PostCreate#Alert",
    "description": "Extract Indicators from Body, Header of the Alert Type \"Phishing\" and \"Suspicious Email\"",
    "isActive": false,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "lastModifyDate": 1646219489,
    "collection": "\/api\/3\/workflow_collections\/817daef5-8d0e-4c2e-8cd7-7d5d8da9ceb4",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/ae90b0ce-1d90-478d-8ec9-7d2eff11246d",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Reply to forwarders",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].reporter}}",
                "config": "88c3d39c-2fa9-4731-b00d-29815008f17c",
                "params": {
                    "cc": "",
                    "to": "{{ vars.input.records[0].reporter.split(\"<\")[1].split(\">\")[0] }}",
                    "bcc": "",
                    "from": "no-reply@cybersponse.com",
                    "type": "Manual Input",
                    "content": "<p>&nbsp;We acknowledge the receipt of a suspicious email with the following subject&nbsp; \"<strong>{{vars.input.records[0].subject}}<\/strong>\"<\/p>",
                    "subject": "Thank you for your submission",
                    "iri_list": "",
                    "body_type": "Rich Text",
                    "file_name": "",
                    "file_path": ""
                },
                "version": "2.3.0",
                "from_str": "soc@cybersponse.com",
                "connector": "smtp",
                "operation": "send_email_new",
                "operationTitle": "Send Email",
                "step_variables": []
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/4c0019b2-055c-44d0-968c-678a0c2d762e",
            "uuid": "b138b4e5-5dc0-4f82-be2d-fe19395bd9fd"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "email": "{{vars.input.records[0]}}",
                "email_header": "{{vars.input.records[0].emailHeaders}}",
                "AlertRecordIRI": "{{vars.input.records[0]['@id']}}"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "uuid": "0e741189-0bff-478c-8fcf-b000986ddacb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Body Indicator",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].emailBody}}",
                "for_each": {
                    "item": "{{vars.steps.Extract_Indicators_from_body.data['unified_result']}}",
                    "condition": ""
                },
                "arguments": {
                    "assetIRI": "",
                    "description": "",
                    "indicatorType": "{{vars.item.picklist_iri}}",
                    "alertRecordIRI": "{{vars.AlertRecordIRI}}",
                    "emailRecordIRI": "",
                    "indicatorValue": "{{vars.item.value}}",
                    "indicatorFileIri": "",
                    "incidentRecordIRI": ""
                },
                "apply_async": true,
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/69af07bb-0ce0-4c27-add3-a30a1818d421"
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "7642966c-383f-41d3-ba83-74286f54e582"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create File Hash Indicators",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].fileHash}}",
                "for_each": {
                    "item": "{{vars.steps.Extract_File_Hash_Indicators.data.MD5}}",
                    "condition": ""
                },
                "arguments": {
                    "assetIRI": "",
                    "description": "",
                    "indicatorType": "{{(\"IndicatorType\" | picklist(\"FileHash-MD5\"))[\"@id\"]}}",
                    "alertRecordIRI": "{{vars.AlertRecordIRI}}",
                    "emailRecordIRI": "",
                    "indicatorValue": "{{vars.item}}",
                    "indicatorFileIri": "",
                    "incidentRecordIRI": ""
                },
                "apply_async": true,
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/69af07bb-0ce0-4c27-add3-a30a1818d421"
            },
            "status": null,
            "top": "1110",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "4b7a4c3e-1096-4e36-b8ef-95af8fc7c834"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract Indicators from header",
            "description": null,
            "arguments": {
                "name": "CyOps Utilities",
                "when": "{{vars.input.records[0].returnPath}}",
                "params": {
                    "data": "{{vars.input.records[0].returnPath}}",
                    "whitelist": "",
                    "case_sensitive": "",
                    "override_regex": "",
                    "private_whitelist": ""
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "extract_artifacts",
                "operationTitle": "CyOPs: Extract Artifacts from string",
                "step_variables": [],
                "operationOutput": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "uuid": "5a3fc475-ef54-40df-baa7-36d28808e8bf"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract Indicators from body",
            "description": null,
            "arguments": {
                "name": "CyOps Utilities",
                "when": "{{vars.input.records[0].emailBody}}",
                "params": {
                    "data": "{{vars.input.records[0].emailBody}}",
                    "whitelist": "",
                    "case_sensitive": "",
                    "override_regex": "",
                    "private_whitelist": ""
                },
                "version": "2.6.0",
                "connector": "cyops_utilities",
                "operation": "extract_artifacts",
                "operationTitle": "CyOPs: Extract Artifacts from string",
                "step_variables": [],
                "operationOutput": []
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "uuid": "941225d3-b893-4917-9f6b-70ef1581fdb7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Header Indicator",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].returnPath}}",
                "for_each": {
                    "item": "{{vars.steps.Extract_Indicators_from_header.data.unified_result}}",
                    "condition": ""
                },
                "arguments": {
                    "assetIRI": "",
                    "description": "",
                    "indicatorType": "{{vars.item.picklist_iri}}",
                    "alertRecordIRI": "{{vars.AlertRecordIRI}}",
                    "emailRecordIRI": "",
                    "indicatorValue": "{{vars.item.value}}",
                    "indicatorFileIri": "",
                    "incidentRecordIRI": ""
                },
                "apply_async": true,
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/69af07bb-0ce0-4c27-add3-a30a1818d421"
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "ca8ab259-8a10-4fb8-929a-145b1f52fbcb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract File Hash Indicators",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].fileHash}}",
                "params": {
                    "data": "{{vars.input.records[0].fileHash}}",
                    "whitelist": "",
                    "case_sensitive": "",
                    "override_regex": "",
                    "private_whitelist": ""
                },
                "version": "2.7.0",
                "connector": "cyops_utilities",
                "operation": "extract_artifacts",
                "operationTitle": "CyOPs: Extract Artifacts from String",
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "uuid": "d98a400f-6fce-470d-9422-409111a11683"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "resource": "alerts",
                "resources": [
                    "alerts"
                ],
                "step_variables": {
                    "input": {
                        "records": [
                            "{{vars.input.records[0]}}"
                        ]
                    }
                },
                "fieldbasedtrigger": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "object",
                            "field": "type",
                            "value": "\/api\/3\/picklists\/c145394b-069a-449b-a05e-67980d0f4b82",
                            "_value": {
                                "itemValue": "Suspicious Email"
                            },
                            "operator": "eq"
                        },
                        {
                            "type": "primitive",
                            "field": "source",
                            "value": "Symantec Email.Cloud",
                            "operator": "neq",
                            "_operator": "neq"
                        }
                    ]
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/ea155646-3821-4542-9702-b246da430a8d",
            "uuid": "ae90b0ce-1d90-478d-8ec9-7d2eff11246d"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Reply to forwarders -> Extract Indicators from header",
            "targetStep": "\/api\/3\/workflow_steps\/5a3fc475-ef54-40df-baa7-36d28808e8bf",
            "sourceStep": "\/api\/3\/workflow_steps\/b138b4e5-5dc0-4f82-be2d-fe19395bd9fd",
            "label": null,
            "isExecuted": false,
            "uuid": "abde09a5-cb12-4206-b1a3-1a2ba16c8d01"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/0e741189-0bff-478c-8fcf-b000986ddacb",
            "sourceStep": "\/api\/3\/workflow_steps\/ae90b0ce-1d90-478d-8ec9-7d2eff11246d",
            "label": null,
            "isExecuted": false,
            "uuid": "a19f9d2f-afbb-445a-8e0f-5d06c321e5ec"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Header Indicator -> Copy  of Create Header Indicator",
            "targetStep": "\/api\/3\/workflow_steps\/7642966c-383f-41d3-ba83-74286f54e582",
            "sourceStep": "\/api\/3\/workflow_steps\/ca8ab259-8a10-4fb8-929a-145b1f52fbcb",
            "label": null,
            "isExecuted": false,
            "uuid": "af3f0132-983e-4b5e-acde-8206ec1ef684"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Body Indicator -> Create URL Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/4b7a4c3e-1096-4e36-b8ef-95af8fc7c834",
            "sourceStep": "\/api\/3\/workflow_steps\/7642966c-383f-41d3-ba83-74286f54e582",
            "label": null,
            "isExecuted": false,
            "uuid": "abb0feb0-a9ed-4033-b425-9c3dedbea764"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Reply to forwarders",
            "targetStep": "\/api\/3\/workflow_steps\/b138b4e5-5dc0-4f82-be2d-fe19395bd9fd",
            "sourceStep": "\/api\/3\/workflow_steps\/0e741189-0bff-478c-8fcf-b000986ddacb",
            "label": null,
            "isExecuted": false,
            "uuid": "7bc8e008-c581-4caa-9430-b8a4bf56c65f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Extract File Hash Indicators -> Create Header Indicator",
            "targetStep": "\/api\/3\/workflow_steps\/ca8ab259-8a10-4fb8-929a-145b1f52fbcb",
            "sourceStep": "\/api\/3\/workflow_steps\/d98a400f-6fce-470d-9422-409111a11683",
            "label": null,
            "isExecuted": false,
            "uuid": "b1f7cc29-1378-4492-9a18-a0ea8a790bef"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Extract Indicators from body -> Extract File Hash Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/d98a400f-6fce-470d-9422-409111a11683",
            "sourceStep": "\/api\/3\/workflow_steps\/941225d3-b893-4917-9f6b-70ef1581fdb7",
            "label": null,
            "isExecuted": false,
            "uuid": "e803b355-328e-4707-af25-609f702e24d4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Extract Indicators from Header -> Extract Indicators from body",
            "targetStep": "\/api\/3\/workflow_steps\/941225d3-b893-4917-9f6b-70ef1581fdb7",
            "sourceStep": "\/api\/3\/workflow_steps\/5a3fc475-ef54-40df-baa7-36d28808e8bf",
            "label": null,
            "isExecuted": false,
            "uuid": "e239fdbb-9b4e-4009-996d-f5935f840419"
        }
    ],
    "priority": null,
    "uuid": "13312e04-6c0c-4f18-8251-f49d5780c2a9",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "PostCreate",
        "FSRSolutionPack",
        "Alerts",
        "vulnerabilityManagement-1.0.1"
    ]
}